doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title ✅ Neon To-Do List
    link(rel="stylesheet", href="todolist.css")
  body
    button#home-button(onclick="window.location.href='/homepage'")
      img.homelogo-image(src="homebutton.png")
    .container
      h1 To-Do List

      .progress-container
        div
          | Keep going, you're doing great!
          #progress
        #numbers 0/0

      .input-container
        input#input-box(type="text", placeholder="Write Your Task")
        button#submit +

      ul#task-list

    script.
      let tasks = [];

      const addtask = () => {
        const input = document.getElementById("input-box");
        const text = input.value.trim();

        if (text !== "") {
          tasks.push({ text: text, completed: false });
          input.value = "";
          update();
        }
      };

      function update() {
        const taskList = document.getElementById("task-list");
        taskList.innerHTML = "";

        tasks.forEach((task, index) => {
          const li = document.createElement("li");
          if (task.completed) li.classList.add("completed");

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = task.completed;
          checkbox.addEventListener("change", () => {
            tasks[index].completed = checkbox.checked;
            update();
          });

          const span = document.createElement("span");
          span.textContent = task.text;

          const editBtn = document.createElement("button");
          editBtn.innerHTML = "Edit";
          editBtn.addEventListener("click", () => {
            const newText = prompt("Edit task:", task.text);
            if (newText !== null && newText.trim() !== "") {
              tasks[index].text = newText.trim();
              update();
            }
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.innerHTML = "Delete";
          deleteBtn.addEventListener("click", () => {
            tasks.splice(index, 1);
            update();
          });

          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(editBtn);
          li.appendChild(deleteBtn);
          taskList.appendChild(li);
        });

        updateProgress();

        // ✅ Save to localStorage
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function updateProgress() {
        const completedCount = tasks.filter((task) => task.completed).length;
        const total = tasks.length;

        document.getElementById("numbers").textContent = `${completedCount}/${total}`;

        const progressBar = document.getElementById("progress");
        const percentage = total === 0 ? 0 : (completedCount / total) * 100;
        progressBar.style.width = `${percentage}%`;
      }

      window.addEventListener("DOMContentLoaded", () => {
        // ✅ Load from localStorage
        const storedTasks = JSON.parse(localStorage.getItem("tasks")) || [];
        tasks = storedTasks;
        update();

        document.getElementById("submit").addEventListener("click", (e) => {
          e.preventDefault();
          addtask();
        });
      });
